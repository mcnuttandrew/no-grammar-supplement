{
  "$schema": "http://vegaar.hkustvis.org/schema/vega-ar/v5.json",
  "width": 600,
  "height": 250,
  "padding": 5,

  "data": [
    {
      "name": "source",
      "url": "http://vegaar.hkustvis.org/us/cse-geo.json",
      "transform": [
        {
          "type": "filter",
          "expr": "datum.x != null && datum.y != null"
        }
      ]
    },
    {
      "name": "contours",
      "source": "source",
      "transform": [
        {
          "type": "contour",
          "x": {"field": "x"},
          "y": { "field": "y"},
          "size": [{ "signal": "width" }, { "signal": "height" }],
          "thresholds": [0.071, 0.09, 0.11, 0.13, 0.15, 0.17, 0.2]
        }
      ]
    }
  ],
  "ar": {
    "mode": "ON",
    "data": [
      {
        "name": "source",
        "values": [
          {"x":532,"y":119.26370390719472},{"x":535,"y":117.47535827186823},
          {"x":585,"y":115.63376714714786},{"x":536,"y":99.25183055609098},
          {"x":543,"y":104.81753687575207},{"x":558,"y":103.89283330034321},
          {"x":554,"y":108.5740130749627},{"x":568,"y":111.04599653903144},
          {"x":590,"y":98.34593850155322},{"x":569,"y":101.05389176865484},{"x":587,"y":115.22064292945586},
          {"x":565,"y":116.94199117422652},{"x":550,"y":100.98092438526486},
          {"x":577,"y":102.41918204342602},{"x":560,"y":119.7312989760147},
          {"x":580,"y":99.19507422647716},{"x":551,"y":109.22516917233278},{"x":528,"y":99.37079074091498},
          {"x":587,"y":97.3172904525679},{"x":559,"y":115.1519825933323},
          {"x":572,"y":119.50281746383305},{"x":567,"y":119.74103043955597},{"x":576,"y":105.11712982046741},
          {"x":561,"y":104.96573538503108},{"x":560,"y":113.24631584144586},{"x":533,"y":111.1051708132673},
          {"x":559,"y":98.93453674052189},{"x":547,"y":112.3102671997006},{"x":581,"y":107.47961983182655},
          {"x":545,"y":120.90680268040514},{"x":571,"y":120.60336585689616},{"x":538,"y":107.1803828475868},
          {"x":534,"y":119.6443078647685},{"x":550,"y":110.63750903413343},{"x":574,"y":109.75826435405999},
          {"x":559,"y":113.61280424540949},{"x":554,"y":104.73689059495847},{"x":531,"y":108.59653893631798},
          {"x":530,"y":119.96432446786997},{"x":557,"y":97.00776693539193},{"x":560,"y":106.80014397488334},
          {"x":539,"y":104.32228665899939},{"x":555,"y":119.39475135310394},{"x":590,"y":110.90693342700648},
          {"x":566,"y":103.6078136945568},
          {"x":590,"y":110.15452266623774},{"x":571,"y":114.13676568941018},{"x":582,"y":104.70555450013299},
          {"x":557,"y":109.9492566210355},{"x":566,"y":109.81043498712366},{"x":529,"y":104.8274344776422},
          {"x":573,"y":101.30741083020196},{"x":530,"y":106.54161120331247},{"x":578,"y":99.22234383729486},
          {"x":535,"y":113.22847475272171},{"x":537,"y":116.7312256557248},{"x":581,"y":102.29929506909424},
          {"x":582,"y":99.97596653566148},{"x":576,"y":102.37184702356434},{"x":588,"y":99.60965226741651},
          {"x":542,"y":117.16335220379307},
          {"x":535,"y":102.747632963621},{"x":587,"y":119.1160104967304},{"x":527,"y":96.80825599872115},
          {"x":551,"y":111.33976430450114},{"x":538,"y":103.41914317572402},
          {"x":536,"y":115.94154717187314},{"x":548,"y":120.97610569750391},
          {"x":536,"y":112.85790406132134},{"x":539,"y":101.35600764023876},
          {"x":544,"y":115.51054864684161},{"x":585,"y":115.50716069551957},
          {"x":552,"y":101.68606134413295},{"x":576,"y":109.93878238415036},
          {"x":538,"y":119.01816362035164},{"x":590,"y":104.98766080363869},
          {"x":572,"y":109.71852342778644},{"x":558,"y":107.01216834480533},
          {"x":538,"y":102.90507145744826},{"x":589,"y":97.41448988410727},{"x":573,"y":120.81227216157106},
          {"x":582,"y":103.66906835924269},{"x":547,"y":101.96427856226258},
          {"x":539,"y":100.30533920393486},{"x":554,"y":113.27049637394124},{"x":542,"y":107.2033688373748},
          {"x":574,"y":106.68220568534477},{"x":543,"y":118.94531811557242},{"x":544,"y":104.00209494158162},
          {"x":566,"y":102.94620313613306},{"x":540,"y":120.88891180656103},
          {"x":531,"y":112.36037603398992},{"x":574,"y":115.98097012000467},{"x":580,"y":106.8457393536785},
          {"x":534,"y":102.07534097759245},{"x":528,"y":109.65824957773},
          {"x":544,"y":101.24610101184929},{"x":544,"y":106.87958369670932},{"x":550,"y":104.92516836745068},
          {"x":544,"y":112.34362622847975}
      ]
      }
    ]
  },
  "scales": [
    {
      "name": "color",
      "type": "linear",
      "domain": { "data": "contours", "field": "value"},
      "range": "ramp"
    }
  ],

  "marks": [
    {
      "type": "image",
      "encode": {
        "enter": {
            "url": {"value":"http://vegaar.hkustvis.org/hkust_map.png"}
        },
        "update": {
          "width": {"signal": "width"},
          "height": {"signal": "height"}
        }
      }
    },
    {
      "type": "path",
      "from": { "data": "contours" },
      "encode": {
        "enter": {
          "stroke": { "value": "#888" },
          "strokeWidth": { "value": 1 },
          "fill": { "scale": "color", "field": "value" },
          "fillOpacity": { "value": 0.35 }
        }
      },
      "transform": [
        { "type": "geopath", "field": "datum" }
      ]
    },
    {
      "name": "marks",
      "type": "symbol",
      "from": { "data": "source" },
      "encode": {
        "update": {
          "x": { "field": "x" },
          "y": { "field": "y" },
          "size": { "value": 5 },
          "fill": { "value": "red" }
        }
      }
    }
  ]
}
